{
  "id": "s3-bucket-requires-security",
  "name": "S3 buckets must have versioning and public access block configured",
  "resource_type": "aws_s3_bucket",
  "severity": "error",
  "requires_resources": [
    {
      "resource_type": "aws_s3_bucket_versioning",
      "relationship": "referenced_by_primary",
      "reference_property": "bucket",
      "min_count": 1,
      "conditions": {
        "versioning_configuration.0.status": "Enabled"
      },
      "message_suffix": "with versioning enabled"
    },
    {
      "resource_type": "aws_s3_bucket_public_access_block",
      "relationship": "referenced_by_primary",
      "reference_property": "bucket",
      "min_count": 1,
      "conditions": {
        "block_public_acls": true,
        "block_public_policy": true
      },
      "message_suffix": "with public access blocked"
    }
  ],
  "message": "S3 bucket {{resource_name}} must have required security configurations"
}
